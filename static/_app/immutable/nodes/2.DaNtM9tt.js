import"../chunks/DsnmJJEf.js";import{i as ha}from"../chunks/Sv-gjAt2.js";import{a7 as ga,a8 as k,a9 as ba,aa as f,ab as l,ac as xa,b as g,ad as c,z as a,L as u,ae as S,af as d,ag as ya,ah as s,ai as Ia,aj as o,u as v,ak as b,al as W}from"../chunks/DrX3vYwl.js";import{i as z}from"../chunks/B5C7Kgw-.js";import{e as Ca,i as ka}from"../chunks/ClDOU8as.js";import{h as za}from"../chunks/3XrW21Iq.js";import{r as Pa,s as wa}from"../chunks/HYIMj859.js";import{b as Ta}from"../chunks/B_3nRxth.js";import{b as Ja}from"../chunks/BfyqA2qU.js";import{p as Ma}from"../chunks/D_7FR-K7.js";import{c as $a}from"../chunks/BnU6kSi0.js";var Ea=f('<div class="loading svelte-nua7fs">جاري البحث...</div>'),Na=f('<div class="error svelte-nua7fs"> </div>'),ja=f('<div class="no-results svelte-nua7fs">لا توجد نتائج للبحث</div>'),Oa=f('<p class="card-excerpt svelte-nua7fs" dir="rtl"><!></p>'),Da=f('<a class="card"><h3 class="grid-one"><p class="card-count"> </p> <p class="card-name"> </p> <p class="card-tag"> </p> <!></h3></a>'),Ha=f('<ul class="menu"><li><a class="home" href="/">الرئيسيه</a></li> <li><a class="home" href="/tags">المصابيح</a></li> <li><a class="home" href="/poets">الشعراء</a></li> <li><a class="home" href="#">الغرض</a></li></ul> <div class="title"><title class="title-bar">aldiwan</title> <h1 class="main-title">الديـــوان الحسيني</h1></div> <div class="search-grid"><input class="searching" type="text" placeholder="اكتب كلمة للبحث..."/> <select class="match-type-select"><option>مطابقة تامة</option><option>جميع الكلمات</option><option>مطابقة تقريبية</option></select></div> <!> <!> <!> <div class="card-grid"></div> <nav class="pagination-buttons"><a class="previous">السابق</a> <span class="pagename"> </span> <a class="next">التالي</a></nav>',1);function Qa(aa,X){ga(X,!1);const Y=u(),x=u(),q=u(),A=$a("https://npllhpweugxvzjpprlxt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wbGxocHdldWd4dnpqcHBybHh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxOTQzMTksImV4cCI6MjA2Nzc3MDMxOX0.CcbMCL0izYcmukksNl04juV_dEPd-rDcDsNrzJEdrCY");typeof window<"u"&&(window.supabase=A);let F=Ma(X,"data",8)().poems,r=u(""),p=u([]),m=u(!1),_=u(""),y=u("all"),L,i=u(1);const P=20;function ea(){if(clearTimeout(L),a(r).trim().length===0){s(p,[]),s(i,1);return}a(r).trim().length<2||(s(i,1),L=setTimeout(()=>{R()},300))}function ta(e,t){if(!e)return"";if(!t.trim())return e;try{const n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=new RegExp(`(${n})`,"gi");return e.replace(C,"<mark>$1</mark>")}catch(n){return console.error("Highlight error:",n),e}}function ra(e,t=1){return e?`<span class="py-1">${e.trim().replace(/\*/g," — ")}</span>`:""}async function R(){if(!a(r).trim()){s(p,[]);return}s(m,!0),s(_,"");try{const{data:e,error:t}=await A.rpc("search_poems_1",{query_text:a(r),match_type:a(y),page_number:a(i)});t?(console.error("Supabase RPC error:",t),s(_,t.message)):s(p,e||[])}catch(e){console.error("Exception during search:",e),s(_,"حدث خطأ في البحث")}finally{s(m,!1)}}function sa(e){const t=(e-1)*P,n=t+P;return a(Y).slice(t,n)}function ia(){a(i)<a(x)&&W(i)}function la(){a(i)>1&&W(i,-1)}k(()=>(a(r),a(i)),()=>{a(r).trim()&&a(i)!==1&&R()}),k(()=>(a(r),a(p)),()=>{s(Y,a(r).trim()?a(p):F)}),k(()=>a(r),()=>{s(x,a(r).trim()?1e3:Math.ceil(F.length/P))}),k(()=>(a(r),a(p),a(i)),()=>{s(q,a(r).trim()?a(p):sa(a(i)))}),ba(),ha();var U=Ha(),w=l(xa(U),4),I=c(w);Pa(I);var T=l(I,2);g(()=>{a(y),Ia(()=>{})});var J=c(T);J.value=J.__value="exact";var M=l(J);M.value=M.__value="all";var V=l(M);V.value=V.__value="any",o(T),o(w);var Z=l(w,2);{var na=e=>{var t=Ea();d(e,t)};z(Z,e=>{a(m)&&e(na)})}var B=l(Z,2);{var oa=e=>{var t=Na(),n=c(t,!0);o(t),g(()=>b(n,a(_))),d(e,t)};z(B,e=>{a(_)&&e(oa)})}var G=l(B,2);{var ca=e=>{var t=ja();d(e,t)};z(G,e=>{a(r),a(p),a(m),v(()=>a(r).trim()&&a(p).length===0&&!a(m))&&e(ca)})}var $=l(G,2);Ca($,5,()=>a(q),ka,(e,t)=>{var n=Da(),C=c(n),j=c(C),ua=c(j);o(j);var O=l(j,2),va=c(O,!0);o(O);var D=l(O,2),da=c(D,!0);o(D);var fa=l(D,2);{var ma=H=>{var h=Oa(),_a=c(h);za(_a,()=>(a(t),a(r),v(()=>ta(ra(a(t).excerpt||a(t).contents,1),a(r))))),o(h),g(()=>h.dir=h.dir),d(H,h)};z(fa,H=>{a(r),v(()=>a(r).trim())&&H(ma)})}o(C),o(n),g(()=>{wa(n,"href",(a(t),v(()=>`/poets/${a(t).poet?.slug}/${a(t).slug}`))),b(ua,`عدد الأبيات ${a(t),v(()=>a(t).counts)??""}`),b(va,(a(t),v(()=>a(t).title))),b(da,(a(t),v(()=>a(t).poet?.poet_name)))}),d(e,n)}),o($);var K=l($,2),E=c(K),N=l(E,2),pa=c(N);o(N);var Q=l(N,2);o(K),g(()=>{E.disabled=a(i)===1,b(pa,`صفحة ${a(i)??""} من ${a(x)??""}`),Q.disabled=a(i)===a(x)}),Ta(I,()=>a(r),e=>s(r,e)),S("input",I,ea),Ja(T,()=>a(y),e=>s(y,e)),S("click",E,la),S("click",Q,ia),d(aa,U),ya()}export{Qa as component};
