import"../chunks/DsnmJJEf.js";import{i as na}from"../chunks/DDtR-bWF.js";import{a6 as va,a7 as pa,a8 as _a,a9 as u,aa as i,ab as da,b as f,ac as c,y as a,K as h,ad as ua,ae as d,af as ma,ag as s,ai as l,ah as fa,u as v,aj as A}from"../chunks/B81JCnP6.js";import{i as b}from"../chunks/B7Ap6yxI.js";import{e as ha,i as ga}from"../chunks/DnphOLbG.js";import{h as F}from"../chunks/Dk2ggp5P.js";import{r as ya,s as xa}from"../chunks/DZN-GXl8.js";import{b as ba}from"../chunks/BqoUxjBh.js";import{b as Pa}from"../chunks/BGjgFe5N.js";import{p as Ua}from"../chunks/BtZ-w9Z_.js";import{c as Aa}from"../chunks/hS-V3q4J.js";import{P as Ea,a as Ba}from"../chunks/DrgLki1e.js";var Ca=u('<div class="loading svelte-13mtav0">جاري البحث...</div>'),Ia=u('<div class="error svelte-13mtav0"> </div>'),Sa=u('<div class="no-results svelte-13mtav0">لا توجد نتائج للبحث</div>'),Ta=u('<p class="no-results svelte-13mtav0">لا توجد قصائد لهذا الشاعر حالياً.</p>'),ka=u('<p class="card-excerpt" dir="rtl"><!></p>'),La=u('<p class="card-excerpt" dir="rtl"><!></p>'),Ra=u('<a class="card"><h3 class="grid-one-poems-slug"><p class="card-count"> </p> <p class="card-name"> </p> <!></h3></a>'),$a=u('<ul class="menu"><li><a class="home" href="/">الرئيسيه</a></li> <li><a class="home" href="/">المعصومين</a></li> <li><a class="home" href="/poets">الشعراء</a></li> <li><a class="home" href="/">الغرض</a></li></ul> <div class="title"><h1 class="main-title"> </h1></div> <div class="search-grid"><input class="searching" type="text" placeholder="ابحث في قصائد الشاعر..." dir="rtl"/> <select class="match-type-select" dir="rtl"><option>مطابقة تامة</option><option>جميع الكلمات</option><option>مطابقة تقريبية</option></select></div> <!> <!> <!> <!> <div class="card-grid"></div>',1);function Ha(G,R){va(R,!1);const $=h(),H=Aa(Ba,Ea);let J=Ua(R,"data",8);const{poet:E,poems:q}=J();let P=h("all"),t=h(""),n=h([]),g=h(!1),y=h(""),K;function Q(r){return r?r.trim().replace(/\*/g," — "):""}function V(r,e){if(!r)return"";if(!e.trim())return r;try{const p=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),U=new RegExp(`(${p})`,"gi");return r.replace(U,"<mark>$1</mark>")}catch{return r}}function W(){if(clearTimeout(K),a(t).trim().length===0){s(n,[]);return}a(t).trim().length<2||(K=setTimeout(()=>{X()},300))}async function X(){if(!a(t).trim()){s(n,[]);return}s(g,!0),s(y,"");try{const{data:r,error:e}=await H.rpc("search_poems_1",{query_text:a(t),page_number:1,match_type:a(P),poet_slug:E.slug});e?(s(y,e.message),s(n,[])):s(n,r||[])}catch{s(y,"حدث خطأ في البحث"),s(n,[])}finally{s(g,!1)}}pa(()=>(a(t),a(n)),()=>{s($,a(t).trim()?a(n):q)}),_a(),na();var N=$a(),B=i(da(N),2),j=c(B),Z=c(j,!0);l(j),l(B);var C=i(B,2),m=c(C);ya(m);var x=i(m,2);f(()=>{a(P),fa(()=>{})});var I=c(x);I.value=I.__value="exact";var S=i(I);S.value=S.__value="all";var w=i(S);w.value=w.__value="any",l(x),l(C);var D=i(C,2);{var aa=r=>{var e=Ca();d(r,e)};b(D,r=>{a(g)&&r(aa)})}var M=i(D,2);{var ra=r=>{var e=Ia(),p=c(e,!0);l(e),f(()=>A(p,a(y))),d(r,e)};b(M,r=>{a(y)&&r(ra)})}var O=i(M,2);{var ea=r=>{var e=Sa();d(r,e)};b(O,r=>{a(t),a(n),a(g),v(()=>a(t).trim()&&a(n).length===0&&!a(g))&&r(ea)})}var Y=i(O,2);{var ta=r=>{var e=Ta();d(r,e)};b(Y,r=>{a(t),v(()=>!a(t).trim()&&q.length===0)&&r(ta)})}var z=i(Y,2);ha(z,5,()=>a($),ga,(r,e)=>{var p=Ra(),U=c(p),T=c(U),sa=c(T);l(T);var k=i(T,2),ia=c(k,!0);l(k);var la=i(k,2);{var oa=_=>{var o=ka(),L=c(o);F(L,()=>(a(e),a(t),v(()=>V(Q(a(e).excerpt||""),a(t))))),l(o),f(()=>o.dir=o.dir),d(_,o)},ca=_=>{var o=La(),L=c(o);F(L,()=>(a(e),v(()=>a(e).excerpt?.replace(/\*/g," — ")||""))),l(o),f(()=>o.dir=o.dir),d(_,o)};b(la,_=>{a(t),v(()=>a(t).trim())?_(oa):_(ca,!1)})}l(U),l(p),f(_=>{xa(p,"href",_),A(sa,`عدد الأبيات ${a(e),v(()=>a(e).counts)??""}`),A(ia,(a(e),v(()=>a(e).title)))},[()=>(a(e),v(()=>`/poets/${encodeURIComponent(E.slug)}/${a(e).slug||a(e).slug}`))]),d(r,p)}),l(z),f(()=>{A(Z,v(()=>E.poet_name)),m.dir=m.dir,x.dir=x.dir}),ba(m,()=>a(t),r=>s(t,r)),ua("input",m,W),Pa(x,()=>a(P),r=>s(P,r)),d(G,N),ma()}export{Ha as component};
