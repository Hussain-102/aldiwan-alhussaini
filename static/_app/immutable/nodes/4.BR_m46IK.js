import"../chunks/DsnmJJEf.js";import{i as va}from"../chunks/DDtR-bWF.js";import{a6 as pa,a7 as _a,a8 as da,a9 as u,aa as i,ab as ua,b as f,ac as c,y as a,K as h,ad as ma,ae as d,af as fa,ag as s,ai as l,ah as ha,u as v,aj as E}from"../chunks/B81JCnP6.js";import{i as b}from"../chunks/B7Ap6yxI.js";import{e as ga,i as ya}from"../chunks/DnphOLbG.js";import{h as F}from"../chunks/Dk2ggp5P.js";import{r as xa,s as ba}from"../chunks/DZN-GXl8.js";import{b as Ua}from"../chunks/BqoUxjBh.js";import{b as Aa}from"../chunks/BGjgFe5N.js";import{p as Ea}from"../chunks/BtZ-w9Z_.js";import{c as Pa}from"../chunks/hS-V3q4J.js";import{e as G}from"../chunks/5bDNJ_cm.js";var Ba=u('<div class="loading svelte-13mtav0">جاري البحث...</div>'),Ca=u('<div class="error svelte-13mtav0"> </div>'),Ia=u('<div class="no-results svelte-13mtav0">لا توجد نتائج للبحث</div>'),Sa=u('<p class="no-results svelte-13mtav0">لا توجد قصائد لهذا الشاعر حالياً.</p>'),Ta=u('<p class="card-excerpt" dir="rtl"><!></p>'),ka=u('<p class="card-excerpt" dir="rtl"><!></p>'),La=u('<a class="card"><h3 class="grid-one-poems-slug"><p class="card-count"> </p> <p class="card-name"> </p> <!></h3></a>'),Ra=u('<ul class="menu"><li><a class="home" href="/">الرئيسيه</a></li> <li><a class="home" href="/">المعصومين</a></li> <li><a class="home" href="/poets">الشعراء</a></li> <li><a class="home" href="/">الغرض</a></li></ul> <div class="title"><h1 class="main-title"> </h1></div> <div class="search-grid"><input class="searching" type="text" placeholder="ابحث في قصائد الشاعر..." dir="rtl"/> <select class="match-type-select" dir="rtl"><option>مطابقة تامة</option><option>جميع الكلمات</option><option>مطابقة تقريبية</option></select></div> <!> <!> <!> <!> <div class="card-grid"></div>',1);function Ga(H,R){pa(R,!1);const $=h(),J=Pa(G.PUBLIC_SUPABASE_URL,G.PUBLIC_SUPABASE_ANON_KEY);let Q=Ea(R,"data",8);const{poet:P,poems:q}=Q();let U=h("all"),t=h(""),n=h([]),g=h(!1),y=h(""),K;function V(r){return r?r.trim().replace(/\*/g," — "):""}function W(r,e){if(!r)return"";if(!e.trim())return r;try{const p=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),A=new RegExp(`(${p})`,"gi");return r.replace(A,"<mark>$1</mark>")}catch{return r}}function X(){if(clearTimeout(K),a(t).trim().length===0){s(n,[]);return}a(t).trim().length<2||(K=setTimeout(()=>{Z()},300))}async function Z(){if(!a(t).trim()){s(n,[]);return}s(g,!0),s(y,"");try{const{data:r,error:e}=await J.rpc("search_poems_1",{query_text:a(t),page_number:1,match_type:a(U),poet_slug:P.slug});e?(s(y,e.message),s(n,[])):s(n,r||[])}catch{s(y,"حدث خطأ في البحث"),s(n,[])}finally{s(g,!1)}}_a(()=>(a(t),a(n)),()=>{s($,a(t).trim()?a(n):q)}),da(),va();var N=Ra(),B=i(ua(N),2),j=c(B),aa=c(j,!0);l(j),l(B);var C=i(B,2),m=c(C);xa(m);var x=i(m,2);f(()=>{a(U),ha(()=>{})});var I=c(x);I.value=I.__value="exact";var S=i(I);S.value=S.__value="all";var w=i(S);w.value=w.__value="any",l(x),l(C);var D=i(C,2);{var ra=r=>{var e=Ba();d(r,e)};b(D,r=>{a(g)&&r(ra)})}var M=i(D,2);{var ea=r=>{var e=Ca(),p=c(e,!0);l(e),f(()=>E(p,a(y))),d(r,e)};b(M,r=>{a(y)&&r(ea)})}var O=i(M,2);{var ta=r=>{var e=Ia();d(r,e)};b(O,r=>{a(t),a(n),a(g),v(()=>a(t).trim()&&a(n).length===0&&!a(g))&&r(ta)})}var Y=i(O,2);{var sa=r=>{var e=Sa();d(r,e)};b(Y,r=>{a(t),v(()=>!a(t).trim()&&q.length===0)&&r(sa)})}var z=i(Y,2);ga(z,5,()=>a($),ya,(r,e)=>{var p=La(),A=c(p),T=c(A),ia=c(T);l(T);var k=i(T,2),la=c(k,!0);l(k);var oa=i(k,2);{var ca=_=>{var o=Ta(),L=c(o);F(L,()=>(a(e),a(t),v(()=>W(V(a(e).excerpt||""),a(t))))),l(o),f(()=>o.dir=o.dir),d(_,o)},na=_=>{var o=ka(),L=c(o);F(L,()=>(a(e),v(()=>a(e).excerpt?.replace(/\*/g," — ")||""))),l(o),f(()=>o.dir=o.dir),d(_,o)};b(oa,_=>{a(t),v(()=>a(t).trim())?_(ca):_(na,!1)})}l(A),l(p),f(_=>{ba(p,"href",_),E(ia,`عدد الأبيات ${a(e),v(()=>a(e).counts)??""}`),E(la,(a(e),v(()=>a(e).title)))},[()=>(a(e),v(()=>`/poets/${encodeURIComponent(P.slug)}/${a(e).slug||a(e).slug}`))]),d(r,p)}),l(z),f(()=>{E(aa,v(()=>P.poet_name)),m.dir=m.dir,x.dir=x.dir}),Ua(m,()=>a(t),r=>s(t,r)),ma("input",m,X),Aa(x,()=>a(U),r=>s(U,r)),d(H,N),fa()}export{Ga as component};
