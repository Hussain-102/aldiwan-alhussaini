import"../chunks/DsnmJJEf.js";import{i as ha}from"../chunks/DDtR-bWF.js";import{a6 as ga,a7 as k,a8 as ba,a9 as f,aa as n,ab as ya,b as g,ac as c,y as a,K as u,ad as S,ae as d,af as xa,ag as s,ah as Ia,ai as o,u as v,aj as b,ak as W}from"../chunks/B81JCnP6.js";import{i as P}from"../chunks/B7Ap6yxI.js";import{e as Ca,i as ka}from"../chunks/DnphOLbG.js";import{h as Pa}from"../chunks/Dk2ggp5P.js";import{r as wa,s as za}from"../chunks/DZN-GXl8.js";import{b as Ta}from"../chunks/BqoUxjBh.js";import{b as Ja}from"../chunks/BGjgFe5N.js";import{p as Ma}from"../chunks/BtZ-w9Z_.js";import{c as $a}from"../chunks/hS-V3q4J.js";var Ea=f('<div class="loading svelte-nua7fs">جاري البحث...</div>'),Na=f('<div class="error svelte-nua7fs"> </div>'),ja=f('<div class="no-results svelte-nua7fs">لا توجد نتائج للبحث</div>'),Oa=f('<p class="card-excerpt svelte-nua7fs" dir="rtl"><!></p>'),Da=f('<a class="card"><h3 class="grid-one"><p class="card-count"> </p> <p class="card-name"> </p> <p class="card-tag"> </p> <!></h3></a>'),Ha=f('<ul class="menu"><li><a class="home" href="/">الرئيسيه</a></li> <li><a class="home" href="/tags">المصابيح</a></li> <li><a class="home" href="/poets">الشعراء</a></li> <li><a class="home" href="#">الغرض</a></li></ul> <div class="title"><title class="title-bar">aldiwan</title> <h1 class="main-title">الديـــوان الحسيني</h1></div> <div class="search-grid"><input class="searching" type="text" placeholder="اكتب كلمة للبحث..."/> <select class="match-type-select"><option>مطابقة تامة</option><option>جميع الكلمات</option><option>مطابقة تقريبية</option></select></div> <!> <!> <!> <div class="card-grid"></div> <nav class="pagination-buttons"><a class="previous">السابق</a> <span class="pagename"> </span> <a class="next">التالي</a></nav>',1);function Qa(aa,X){ga(X,!1);const Y=u(),y=u(),q=u(),A=$a("https://npllhpweugxvzjpprlxt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wbGxocHdldWd4dnpqcHBybHh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxOTQzMTksImV4cCI6MjA2Nzc3MDMxOX0.CcbMCL0izYcmukksNl04juV_dEPd-rDcDsNrzJEdrCY");typeof window<"u"&&(window.supabase=A);let F=Ma(X,"data",8)().poems,r=u(""),p=u([]),m=u(!1),_=u(""),x=u("all"),K,i=u(1);const w=20;function ea(){if(clearTimeout(K),a(r).trim().length===0){s(p,[]),s(i,1);return}a(r).trim().length<2||(s(i,1),K=setTimeout(()=>{R()},300))}function ta(e,t){if(!e)return"";if(!t.trim())return e;try{const l=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=new RegExp(`(${l})`,"gi");return e.replace(C,"<mark>$1</mark>")}catch(l){return console.error("Highlight error:",l),e}}function ra(e,t=1){return e?`<span class="py-1">${e.trim().replace(/\*/g," — ")}</span>`:""}async function R(){if(!a(r).trim()){s(p,[]);return}s(m,!0),s(_,"");try{const{data:e,error:t}=await A.rpc("search_poems_1",{query_text:a(r),match_type:a(x),page_number:a(i)});t?(console.error("Supabase RPC error:",t),s(_,t.message)):s(p,e||[])}catch(e){console.error("Exception during search:",e),s(_,"حدث خطأ في البحث")}finally{s(m,!1)}}function sa(e){const t=(e-1)*w,l=t+w;return a(Y).slice(t,l)}function ia(){a(i)<a(y)&&W(i)}function na(){a(i)>1&&W(i,-1)}k(()=>(a(r),a(i)),()=>{a(r).trim()&&a(i)!==1&&R()}),k(()=>(a(r),a(p)),()=>{s(Y,a(r).trim()?a(p):F)}),k(()=>a(r),()=>{s(y,a(r).trim()?1e3:Math.ceil(F.length/w))}),k(()=>(a(r),a(p),a(i)),()=>{s(q,a(r).trim()?a(p):sa(a(i)))}),ba(),ha();var U=Ha(),z=n(ya(U),4),I=c(z);wa(I);var T=n(I,2);g(()=>{a(x),Ia(()=>{})});var J=c(T);J.value=J.__value="exact";var M=n(J);M.value=M.__value="all";var V=n(M);V.value=V.__value="any",o(T),o(z);var Z=n(z,2);{var la=e=>{var t=Ea();d(e,t)};P(Z,e=>{a(m)&&e(la)})}var B=n(Z,2);{var oa=e=>{var t=Na(),l=c(t,!0);o(t),g(()=>b(l,a(_))),d(e,t)};P(B,e=>{a(_)&&e(oa)})}var G=n(B,2);{var ca=e=>{var t=ja();d(e,t)};P(G,e=>{a(r),a(p),a(m),v(()=>a(r).trim()&&a(p).length===0&&!a(m))&&e(ca)})}var $=n(G,2);Ca($,5,()=>a(q),ka,(e,t)=>{var l=Da(),C=c(l),j=c(C),ua=c(j);o(j);var O=n(j,2),va=c(O,!0);o(O);var D=n(O,2),da=c(D,!0);o(D);var fa=n(D,2);{var ma=H=>{var h=Oa(),_a=c(h);Pa(_a,()=>(a(t),a(r),v(()=>ta(ra(a(t).excerpt||a(t).contents,1),a(r))))),o(h),g(()=>h.dir=h.dir),d(H,h)};P(fa,H=>{a(r),v(()=>a(r).trim())&&H(ma)})}o(C),o(l),g(()=>{za(l,"href",(a(t),v(()=>`/poets/${a(t).poet?.slug}/${a(t).slug}`))),b(ua,`عدد الأبيات ${a(t),v(()=>a(t).counts)??""}`),b(va,(a(t),v(()=>a(t).title))),b(da,(a(t),v(()=>a(t).poet?.poet_name)))}),d(e,l)}),o($);var L=n($,2),E=c(L),N=n(E,2),pa=c(N);o(N);var Q=n(N,2);o(L),g(()=>{E.disabled=a(i)===1,b(pa,`صفحة ${a(i)??""} من ${a(y)??""}`),Q.disabled=a(i)===a(y)}),Ta(I,()=>a(r),e=>s(r,e)),S("input",I,ea),Ja(T,()=>a(x),e=>s(x,e)),S("click",E,na),S("click",Q,ia),d(aa,U),xa()}export{Qa as component};
