import"../chunks/DsnmJJEf.js";import{i as va}from"../chunks/Sv-gjAt2.js";import{a7 as pa,a8 as _a,a9 as da,aa as u,ab as i,ac as ua,b as f,ad as c,z as a,L as h,ae as ma,af as d,ag as fa,ah as s,aj as l,ai as ha,u as v,ak as E}from"../chunks/DrX3vYwl.js";import{i as b}from"../chunks/B5C7Kgw-.js";import{e as ga,i as xa}from"../chunks/ClDOU8as.js";import{h as F}from"../chunks/3XrW21Iq.js";import{r as ya,s as ba}from"../chunks/HYIMj859.js";import{b as Ua}from"../chunks/B_3nRxth.js";import{b as Aa}from"../chunks/BfyqA2qU.js";import{p as Ea}from"../chunks/D_7FR-K7.js";import{c as Pa}from"../chunks/BnU6kSi0.js";import{e as G}from"../chunks/Bxq4krK-.js";var ka=u('<div class="loading svelte-13mtav0">جاري البحث...</div>'),Ba=u('<div class="error svelte-13mtav0"> </div>'),Ca=u('<div class="no-results svelte-13mtav0">لا توجد نتائج للبحث</div>'),Ia=u('<p class="no-results svelte-13mtav0">لا توجد قصائد لهذا الشاعر حالياً.</p>'),La=u('<p class="card-excerpt" dir="rtl"><!></p>'),Sa=u('<p class="card-excerpt" dir="rtl"><!></p>'),Ta=u('<a class="card"><h3 class="grid-one-poems-slug"><p class="card-count"> </p> <p class="card-name"> </p> <!></h3></a>'),Ra=u('<ul class="menu"><li><a class="home" href="/">الرئيسيه</a></li> <li><a class="home" href="/">المعصومين</a></li> <li><a class="home" href="/poets">الشعراء</a></li> <li><a class="home" href="/">الغرض</a></li></ul> <div class="title"><h1 class="main-title"> </h1></div> <div class="search-grid"><input class="searching" type="text" placeholder="ابحث في قصائد الشاعر..." dir="rtl"/> <select class="match-type-select" dir="rtl"><option>مطابقة تامة</option><option>جميع الكلمات</option><option>مطابقة تقريبية</option></select></div> <!> <!> <!> <!> <div class="card-grid"></div>',1);function Ga(H,R){pa(R,!1);const $=h(),J=Pa(G.PUBLIC_SUPABASE_URL,G.PUBLIC_SUPABASE_ANON_KEY);let Q=Ea(R,"data",8);const{poet:P,poems:q}=Q();let U=h("all"),t=h(""),n=h([]),g=h(!1),x=h(""),N;function V(r){return r?r.trim().replace(/\*/g," — "):""}function W(r,e){if(!r)return"";if(!e.trim())return r;try{const p=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),A=new RegExp(`(${p})`,"gi");return r.replace(A,"<mark>$1</mark>")}catch{return r}}function X(){if(clearTimeout(N),a(t).trim().length===0){s(n,[]);return}a(t).trim().length<2||(N=setTimeout(()=>{Z()},300))}async function Z(){if(!a(t).trim()){s(n,[]);return}s(g,!0),s(x,"");try{const{data:r,error:e}=await J.rpc("search_poems_1",{query_text:a(t),page_number:1,match_type:a(U),poet_slug:P.slug});e?(s(x,e.message),s(n,[])):s(n,r||[])}catch{s(x,"حدث خطأ في البحث"),s(n,[])}finally{s(g,!1)}}_a(()=>(a(t),a(n)),()=>{s($,a(t).trim()?a(n):q)}),da(),va();var j=Ra(),k=i(ua(j),2),w=c(k),aa=c(w,!0);l(w),l(k);var B=i(k,2),m=c(B);ya(m);var y=i(m,2);f(()=>{a(U),ha(()=>{})});var C=c(y);C.value=C.__value="exact";var I=i(C);I.value=I.__value="all";var z=i(I);z.value=z.__value="any",l(y),l(B);var D=i(B,2);{var ra=r=>{var e=ka();d(r,e)};b(D,r=>{a(g)&&r(ra)})}var K=i(D,2);{var ea=r=>{var e=Ba(),p=c(e,!0);l(e),f(()=>E(p,a(x))),d(r,e)};b(K,r=>{a(x)&&r(ea)})}var M=i(K,2);{var ta=r=>{var e=Ca();d(r,e)};b(M,r=>{a(t),a(n),a(g),v(()=>a(t).trim()&&a(n).length===0&&!a(g))&&r(ta)})}var O=i(M,2);{var sa=r=>{var e=Ia();d(r,e)};b(O,r=>{a(t),v(()=>!a(t).trim()&&q.length===0)&&r(sa)})}var Y=i(O,2);ga(Y,5,()=>a($),xa,(r,e)=>{var p=Ta(),A=c(p),L=c(A),ia=c(L);l(L);var S=i(L,2),la=c(S,!0);l(S);var oa=i(S,2);{var ca=_=>{var o=La(),T=c(o);F(T,()=>(a(e),a(t),v(()=>W(V(a(e).excerpt||""),a(t))))),l(o),f(()=>o.dir=o.dir),d(_,o)},na=_=>{var o=Sa(),T=c(o);F(T,()=>(a(e),v(()=>a(e).excerpt?.replace(/\*/g," — ")||""))),l(o),f(()=>o.dir=o.dir),d(_,o)};b(oa,_=>{a(t),v(()=>a(t).trim())?_(ca):_(na,!1)})}l(A),l(p),f(_=>{ba(p,"href",_),E(ia,`عدد الأبيات ${a(e),v(()=>a(e).counts)??""}`),E(la,(a(e),v(()=>a(e).title)))},[()=>(a(e),v(()=>`/poets/${encodeURIComponent(P.slug)}/${a(e).slug||a(e).slug}`))]),d(r,p)}),l(Y),f(()=>{E(aa,v(()=>P.poet_name)),m.dir=m.dir,y.dir=y.dir}),Ua(m,()=>a(t),r=>s(t,r)),ma("input",m,X),Aa(y,()=>a(U),r=>s(U,r)),d(H,j),fa()}export{Ga as component};
